{
	"name": "ProcessProviderJsonToSynapseSql",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "RawProvider",
						"type": "DatasetReference"
					},
					"name": "Json"
				}
			],
			"sinks": [
				{
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "filterNullNpi"
				}
			],
			"scriptLines": [
				"source(output(",
				"          {_index} as string,",
				"          {_type} as string,",
				"          {_source} as (provider_type as string, metadata as (last_updated as string, {_source} as (last_updated as string, created as string, pma_last_updated as string, last_modified as string), last_modified as string), notes as string, chair_at_api as ({MedStar Washington Hospital Center} as string, {MedStar Franklin Square Medical Center} as string, {MedStar Harbor Hospital} as string, {MedStar National Rehabilitation Network} as string, {MedStar Medical Group} as string, {MedStar Union Memorial Hospital} as string, {MedStar Georgetown University Hospital} as string, {MedStar Southern Maryland Hospital Center} as string, {MedStar Good Samaritan Hospital} as string, {MedStar Montgomery Medical Center} as string, {MedStar St. Mary's Hospital} as string)[], sort_preferences as (networks as integer), blogs as string, appointment_reasons as string[], clinical_focus as string, show_in_pmac as string, provider_is_employed as string, videos as string[], degrees as (name as string, source as string, source_url as string)[], practice_groups as (has_info as boolean, name as string, id as integer)[], age_groups_seen_range as string, employed as boolean, default_timezone as string, network_affiliations as string[], specialties as (specialty as string, subspecialty as string, aliases as string[], is_certified as boolean, practice_focus as string, eui as string, piped_name as string)[], service_line_lead_not_at as string[], multi_resource_scheduling as string, reviews as string, medical_school as string[], manually_created as string, id as integer, customer_code as string, professional_statement as string, main_contacts as (phone as string, fax as string), access_program_status as string, in_the_news as string, image_url as string, raw as (age_groups_seen as string[], primary_specialty as string, contacts as (contact_type as string, extension as string, subtype as string, value as string)[]), case_types_seen as string[], blacklisted_not_at as string[], number_of_videos as integer, about_the_provider as string, location_change_form as string, years_in_practice as string, primary_video as string, blacklisted_at as string[], service_line_lead_at as string[], service_line_lead_at_api as ({MedStar Washington Hospital Center} as string, {MedStar Franklin Square Medical Center} as string, {MedStar Harbor Hospital} as string, {MedStar National Rehabilitation Network} as string, {MedStar Medical Group} as string, {MedStar Union Memorial Hospital} as string, {MedStar Georgetown University Hospital} as string, {MedStar Southern Maryland Hospital Center} as string, {MedStar Good Samaritan Hospital} as string, {MedStar Montgomery Medical Center} as string, {MedStar St. Mary's Hospital} as string)[], chief_at_api as ({MedStar Washington Hospital Center} as string, {MedStar Franklin Square Medical Center} as string, {MedStar Harbor Hospital} as string, {MedStar National Rehabilitation Network} as string, {MedStar Medical Group} as string, {MedStar Union Memorial Hospital} as string, {MedStar Georgetown University Hospital} as string, {MedStar Southern Maryland Hospital Center} as string, {MedStar Good Samaritan Hospital} as string, {MedStar Montgomery Medical Center} as string, {MedStar St. Mary's Hospital} as string)[], chief_not_at as string[], scope_of_practice as (types as ({} as string), concepts as string[]), accepting_new_patients as boolean, name as (full_with_prefix as string, full_name as string, prefix as string, full_with_degrees as string, last_name as string, raw as (full_name as string, middle_name as string), suffix_with_degrees as string, middle_name as string, suffix as string, first_name as string, full_with_prefix_and_degrees as string), current_status as string, is_specialty_care as boolean, preferred_name as string, social_sites as string, show_in_api as string, gender as string, appointment_type_code_whitelist as string[], blacklisted_at_api as ({MedStar Washington Hospital Center} as string, {MedStar Franklin Square Medical Center} as string, {MedStar Harbor Hospital} as string, {MedStar National Rehabilitation Network} as string, {MedStar Medical Group} as string, {MedStar Union Memorial Hospital} as string, {MedStar Georgetown University Hospital} as string, {MedStar Southern Maryland Hospital Center} as string, {MedStar Good Samaritan Hospital} as string, {MedStar Montgomery Medical Center} as string, {MedStar St. Mary's Hospital} as string)[], primary_specialty as string, external_id as string, training as string[], networks as (network as string)[], is_doctor as boolean, board_certifications as string[], insurance_accepted as string[], availability_last_updated as string, supplemental_videos as string, number_of_pictures as integer, referral_phone as string, languages as (language as string)[], chief_at as string[], npi as string, appt_scheduler_emails as string, hospital_affiliations as string[], chair_not_at as string[], location_schedule as string, fellowship as string, is_primary_care as boolean, clinical_contact as string, chair_at as string[], entity_type as string, podcasts as string, research_pubs as string, age_groups_seen as string[], patient_testimonials as string, awards as string, professional_activities as string, is_live as boolean, locations as (commercial_entity_name as string, distance as string, city as string, timezone as string, doctor_contacts as (phone as string, fax as string), external_id as string, external_organization_id as string, networks as string[], type as string, ehr_location_id as string, location_contacts as (phone as string, fax as string), source_system_type as string, rank as integer, street1 as string, id as string, state as string, street2 as string, email as string, zip as string, office_hours as string, address as (line as string, building as string), source_system as string, coordinates as (lon as double, lat as double), primary_marketable_location_id as string, raw as (suite as string, street1 as string, street2 as string, contacts as string[]), suite as string, accepting_new_patients as string, facility_fee as boolean, name as string, associated_marketable_location_ids as string[])[], status_transitions as string, personal_email as string),",
				"          {_id} as string,",
				"          {_score} as double",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     moveFiles: ['providers/raw','providers/processed'],",
				"     documentForm: 'documentPerLine',",
				"     wildcardPaths:[('providers/raw/true/Baltimore_21201/*.json')]) ~> Json",
				"Json filter(isNull({_id})) ~> filterNullNpi",
				"filterNullNpi sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     store: 'synapse',",
				"     databaseType: 'spark',",
				"     format: 'table',",
				"     database: 'RawLakeDb',",
				"     tableName: 'providers',",
				"     mapColumn(",
				"          NPI = {_id},",
				"          PROVIDER_TYPE = {_source}.provider_type,",
				"          NAME = {_source}.name.full_name,",
				"          GENDER = {_source}.gender,",
				"          SPECIALITY = {_source}.specialties[1].specialty,",
				"          ADDRESS = {_source}.locations[1].address,",
				"          CITY = {_source}.locations[1].city,",
				"          STATE = {_source}.locations[1].state,",
				"          ZIP = {_source}.locations[1].zip",
				"     ),",
				"     preCommands: [],",
				"     postCommands: []) ~> sink1"
			]
		}
	}
}